
# 流程

容器组件接收一个本地目录地址，该目录下有单独一个小程序应用的所有完整文件。这些文件应当是服务端打包处理后的结果文件。

**TODO**: 小程序应用包的正确性与完备性校验

**TODO**: 小程序应用版本校验和升级策略

## 输入

最重要的两个文件：表示视图结构的`app.xml`与表示数据和操作的`app.js`文件。另有表示主题，颜色等资源文件。

### app.xml

app.xml文件是经过`xml_flutter`工具处理的生成文件，结点名称与flutter控件一一对应。

### app.js

app.xml文件是经过远端的nodejs工具打包处理后的结果文件，所有的可执行js脚本代码全部集中在一个文件中。

## 解析

将xml文本文件表示成结构化数据，解析类的为`WidgetAssembler`，表示节点的类为`AssembleElement`

## 转化

遍历`AssembleElement`树，运行时生flutter控件树，同时在`AssembleElement`节点的属性中判断是否存在`变量`,`条件判断`和`循环`，生成自定义的flutter控件: `BindingWidget`，`ConditionWidget`和`LoopWidget`。

## 数据

数据变更引起视图变化，包含2个过程:

- 构建视图时获取数据进行填充

- 视图上的交互传至数据层，引起数据变化，数据的变化再传导到视图更新

`ScriptEngine`接口统一了这2个过程，根据传递给`ScriptEngine`的表达式文本，由`ScriptEngine`实现体进行实际运算，返回运算结果。

**TODO**: 引擎运算表达式在单独的`Isolate`中，即脚本执行异步化。

## 运行

在PC上直接运行，能够方便的更改应用的尺寸，从而随时查看自适应效果；有助于检验CSS属性组合与flutter控件生成效果。

# 层次结构

## 视图层

除了生成控件对象外，还需要将小程序中的颜色，主题等资源进行应用，另用额外的资源类表示这些对象的处理：`AssembleResource`

## 数据层

`ScriptEngine`运算结果需要传递给对应的flutter控件，这个控件处于庞大的控件树中，因此除了数据运算还包括数据绑定，绑定过程与解析过程相关联。
